---
- name: deploy Prometheus Operator and Grafana
  hosts: localhost
  gather_facts: false
  become: false
  vars_files:
    - "env/setup.yaml"
    - "env/app.yaml"
  vars:
    kubeconfig: "{{ kube_dir }}/{{ kube_config }}"
  roles:
    - { role: prometheus-operator, tags: prometheus-operator }
  pre_tasks:
    - name: install Ansible module dependencies
      pip:
        name: openshift
        state: present
    - name: "create k8s namespace - {{ namespace.prometheusOperator }}"
      community.kubernetes.k8s:
        kubeconfig: "{{ kubeconfig }}"
        name: "{{ namespace.prometheusOperator }}"
        api_version: v1
        kind: Namespace
        state: present
